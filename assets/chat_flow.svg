<svg viewBox="0 0 900 1200" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <style>
      .node { fill: #E8EAF6; stroke: #3F51B5; stroke-width: 2; }
      .start-end { fill: #C8E6C9; stroke: #4CAF50; stroke-width: 2; }
      .node-text { font-family: Arial, sans-serif; font-size: 16px; fill: #1a237e; font-weight: 500; }
      .edge-label { font-family: Arial, sans-serif; font-size: 13px; fill: #424242; font-weight: 500; }
      .edge-label-bg { fill: white; opacity: 0.9; }
      .arrow { fill: none; stroke: #424242; stroke-width: 2; }
      .conditional-arrow { fill: none; stroke: #FF6F00; stroke-width: 2; stroke-dasharray: 5,5; }
      .loop-arrow { fill: none; stroke: #1976D2; stroke-width: 2; }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#424242" />
    </marker>
    <marker id="arrowhead-conditional" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#FF6F00" />
    </marker>
    <marker id="arrowhead-loop" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#1976D2" />
    </marker>
  </defs>

  <!-- Title -->
  <text x="450" y="40" font-family="Arial, sans-serif" font-size="24" font-weight="bold" text-anchor="middle" fill="#1a237e">
    LangGraph Workflow Diagram
  </text>

  <!-- START Node -->
  <ellipse cx="450" cy="110" rx="60" ry="35" class="start-end"/>
  <text x="450" y="117" class="node-text" text-anchor="middle">START</text>

  <!-- Two branches from START -->
  <path d="M 450 145 L 310 220" class="arrow" marker-end="url(#arrowhead)"/>
  <path d="M 450 145 L 680 220" class="arrow" marker-end="url(#arrowhead)"/>

  <!-- Left branch: Check Title Condition (diamond) -->
  <path d="M 310 220 L 450 320 L 310 420 L 170 320 Z" class="node"/>
  <text x="310" y="310" class="node-text" text-anchor="middle">Check Thread</text>
  <text x="310" y="330" class="node-text" text-anchor="middle">Title Condition</text>


  <!-- Conditional Edge: Title Present -> Generate Title -->
  <path d="M 450 320 L 450 860" class="conditional-arrow" marker-end="url(#arrowhead-conditional)"/>
    <rect x="380" y="600" width="140" height="32" class="edge-label-bg"/>
  <text x="450" y="620" class="edge-label" text-anchor="middle">Title Present (END)</text>
  <!-- Conditional Edge: Title Missing -> Generate Title -->
  
  <path d="M 170 320 L 170 460" class="conditional-arrow" marker-end="url(#arrowhead-conditional)"/>
  <rect x="80" y="400" width="180" height="32" class="edge-label-bg"/>
  <text x="170" y="418" class="edge-label" text-anchor="middle">Title Missing (GENERATE)</text>

  <!-- Generate Title Node (process) -->
  <rect x="100" y="460" width="160" height="70" rx="10" class="node"/>
  <text x="180" y="488" class="node-text" text-anchor="middle">generate_title</text>
  <text x="180" y="508" class="node-text" text-anchor="middle">Node</text>

  <!-- Arrow from generate_title to END -->
  <path d="M 180 530 L 180 900 L 380 900" class="arrow" marker-end="url(#arrowhead)"/>

  <!-- Right branch: chat_node (process) -->
  <rect x="600" y="220" width="160" height="70" rx="10" class="node"/>
  <text x="680" y="248" class="node-text" text-anchor="middle">chat_node</text>
  <text x="680" y="268" class="node-text" text-anchor="middle">(Agent)</text>

<!-- Tool Condition (diamond) shifted right by 80 -->
<path d="M 680 320 L 760 360 L 680 400 L 600 360 Z" class="node"/>
<text x="680" y="365" class="node-text" text-anchor="middle">Tool Condition</text>

  <!-- Arrow from chat_node to Tool Condition -->
  <path d="M 680 290 L 680 320" class="arrow" marker-end="url(#arrowhead)"/>

  <!-- Conditional Edge: Tool Required -> Tool Node -->
  <path d="M 680 400 L 680 450" class="conditional-arrow" marker-end="url(#arrowhead-conditional)"/>
  <rect x="693" y="410" width="90" height="18" class="edge-label-bg"/>
  <text x="738" y="423" class="edge-label" text-anchor="middle">Tool Required</text>

  <!-- Tool Node (process) -->
  <rect x="600" y="450" width="160" height="70" rx="10" class="node"/>
  <text x="680" y="478" class="node-text" text-anchor="middle">tools</text>
  <text x="680" y="498" class="node-text" text-anchor="middle">(Execute Tools)</text>

  <!-- Loop back to Chat Node -->
  <path d="M 600 485 L 530 485 L 530 240 L 600 240" class="loop-arrow" marker-end="url(#arrowhead-loop)"/>
  <rect x="503" y="345" width="60" height="42" class="edge-label-bg"/>
  <text x="532" y="363" class="edge-label" text-anchor="middle">Return</text>
  <text x="532" y="378" class="edge-label" text-anchor="middle">to Agent</text>

  <!-- Arrow from tools to END -->
  <!-- <path d="M 680 520 L 680 900 L 520 900" class="arrow" marker-end="url(#arrowhead)"/> -->

  <!-- Conditional Edge: No Tool -> END -->
  <path d="M 760 360 L 820 360 L 820 900 L 520 900" class="conditional-arrow" marker-end="url(#arrowhead-conditional)"/>
  <rect x="765" y="630" width="125" height="32" class="edge-label-bg"/>
  <text x="830" y="650" class="edge-label" text-anchor="middle">No Tool (Complete)</text>

  <!-- END Node at bottom -->
  <ellipse cx="450" cy="900" rx="70" ry="40" class="start-end"/>
  <text x="450" y="910" class="node-text" text-anchor="middle" font-size="18">END</text>

  <!-- Legend -->
  <g transform="translate(100, 1020)">
    <text x="0" y="0" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#1a237e">Legend:</text>

    <!-- Keep arrows vertical -->
    <line x1="0" y1="30" x2="60" y2="30" class="arrow" marker-end="url(#arrowhead)"/>
    <text x="75" y="35" class="edge-label">Standard Flow</text>

    <line x1="0" y1="60" x2="60" y2="60" class="conditional-arrow" marker-end="url(#arrowhead-conditional)"/>
    <text x="75" y="65" class="edge-label">Conditional Edge</text>

    <line x1="0" y1="90" x2="60" y2="90" class="loop-arrow" marker-end="url(#arrowhead-loop)"/>
    <text x="75" y="95" class="edge-label">Loop/Return</text>

    <!-- Nodes aligned horizontally -->
    <!-- Process Node -->
    <rect x="200" y="30" width="100" height="50" rx="10" class="node"/>
    <text x="250" y="60" class="edge-label" text-anchor="middle">Process Node</text>

    <!-- Start/End (moved right) -->
    <ellipse cx="420" cy="55" rx="50" ry="25" class="start-end"/>
    <text x="420" y="60" class="edge-label" text-anchor="middle">Start/End</text>

    <!-- Decision (moved right) -->
    <path d="M 610 30 L 670 55 L 610 80 L 550 55 Z" class="node"/>
    <text x="610" y="60" class="edge-label" text-anchor="middle">Decision</text>
  </g>
</svg>
